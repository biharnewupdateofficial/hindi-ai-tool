<!DOCTYPE html>
<html>
<head>
<title>OpenTutor AI</title>
<link rel="stylesheet" href="/static/style.css">
</head>
<body>

<div class="app">
  <div class="header">
    ğŸ¤– OpenTutor AI
    <label style="float:right">
      ğŸ”Š Speak
      <input type="checkbox" id="voiceToggle" checked>
    </label>
  </div>

  <div id="chat">
    {% for r,m in chats %}
      <div class="{{r}} ai-msg">{{m}}</div>
    {% endfor %}
  </div>

  <div class="input">
    <button onclick="mic()">ğŸ¤</button>
    <textarea id="q" placeholder="Type or say..."></textarea>
    <button onclick="send()">Send</button>
  </div>

  <p style="font-size:14px">
    ğŸ–¼ï¸ Image ke liye likho: <b>image: ek sher jungle me</b>
  </p>
</div>

<script>
let speakOn = true;

document.getElementById("voiceToggle").onchange = e=>{
  speakOn = e.target.checked;
};

// SEND MESSAGE
function send(){
  let q = document.getElementById("q").value.trim();
  if(!q) return;

  fetch("/ask",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({question:q})
  })
  .then(r=>r.json())
  .then(d=>{
    location.reload();
    if(speakOn){
      speak(d.answer);
    }
  });
}

// ğŸ¤ Voice to Text
function mic(){
  let r = new(window.SpeechRecognition||webkitSpeechRecognition)();
  r.lang="hi-IN";
  r.onresult=e=>{
    document.getElementById("q").value=e.results[0][0].transcript;
  };
  r.start();
}

// ğŸ”Š Text to Speech
function speak(text){
  const u = new SpeechSynthesisUtterance(text);
  u.lang="hi-IN";
  speechSynthesis.speak(u);
}
</script>

</body>
</html>
