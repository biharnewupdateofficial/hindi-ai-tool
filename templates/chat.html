<!DOCTYPE html>
<html>
<head>
<title>OpenTutor AI</title>
<link rel="stylesheet" href="/static/style.css">
</head>

<body class="dark">

<header>
  <h2>ðŸ¤– OpenTutor AI</h2>
  <div class="modes">
    <button onclick="toggleVoice()">ðŸ”Š Voice</button>
  </div>
</header>

<div id="chat">
{% for m in messages %}
  <div class="{{ m.role }}">{{ m.text }}</div>
  {% if m.role == 'assistant' %}
  <script>
    speak(`{{ m.text | safe }}`);
  </script>
  {% endif %}
{% endfor %}
</div>

<div class="input">
  <textarea id="q" placeholder="Type or Speak..."></textarea>
  <button onclick="startVoice()">ðŸŽ™</button>
  <button onclick="send()">Send</button>
</div>

<script>
let voiceOn = true;

function toggleVoice(){
  voiceOn = !voiceOn;
  alert("Voice " + (voiceOn ? "ON" : "OFF"));
}

function speak(text){
  if(!voiceOn) return;
  let msg = new SpeechSynthesisUtterance(text);
  msg.lang="hi-IN";
  speechSynthesis.speak(msg);
}

function send(){
  let q=document.getElementById("q").value;
  if(!q) return;
  fetch("/ask",{method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({question:q})
  }).then(()=>location.reload());
}

function startVoice(){
  let rec = new webkitSpeechRecognition();
  rec.lang="hi-IN";
  rec.onresult=e=>{
    document.getElementById("q").value=e.results[0][0].transcript;
  }
  rec.start();
}
</script>

</body>
</html>
